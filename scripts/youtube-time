#!/usr/bin/env bash

if [[ $# -ne 4 ]]; then
    echo "Less Parameters Passed"
    exit 1
fi

START_TIME="$1"
END_TIME="$2"
OUTPUT_FILENAME="$3"
VIDEO_URL="$4"
TEMP_VIDEO="temp_video.mp4"

echo "Fetching video from the provided link..."
yt-dlp -f best -o "$TEMP_VIDEO" "$VIDEO_URL"

if [[ $? -ne 0 ]]; then
    echo "Something went wrong while downloading the video."
    exit 1
fi

START_SECONDS=$(( ${START_TIME%:*} * 60 + ${START_TIME#*:} ))
END_SECONDS=$(( ${END_TIME%:*} * 60 + ${END_TIME#*:} ))

DURATION=$(( END_SECONDS - START_SECONDS ))

echo "Extracting clip from $START_TIME to $END_TIME..."
ffmpeg -i "$TEMP_VIDEO" -ss "$START_TIME" -t "$DURATION" -c:v copy -c:a copy "$OUTPUT_FILENAME"

if [[ $? -ne 0 ]]; then
    echo "Failed to process the requested video segment."
    rm -f "$TEMP_VIDEO"
    exit 1
fi

rm -f "$TEMP_VIDEO"
echo "Clip successfully saved as $OUTPUT_FILENAME"

# TODO: Make a script to download youtube video from given timeframes
#
# E.g.: youtube-time 2:00 4:00 tutorial.mkv "https://www.youtube.com/watch?v=SPwyp2NG-bE"
# The above command should create a output file which contains the video from 2 min to 4 min.
#
# Refer: youtube-dl and ffmpeg commands for this
